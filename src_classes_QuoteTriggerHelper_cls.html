<table id="fileDiffTable" class="diff-tbl" style="border: 0 solid #e4e4e4 !important;" width="100%" cellspacing="0" cellpadding="0" border="0"><thead><tr><td colspan='3' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 25px;'><b>File Name:src/classes/QuoteTriggerHelper.cls</b></td><td colspan='3' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 25px;'><b>145 changes:</b>119 addition(s) | 26 deletion(s)</td></tr></thead><tbody><tr/><tr><td colspan='6' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 20px;'>@@ -1,24 +1,81 @@</td></tr><tr><td style='background-color:#FFFFFF'>1</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp> public class QuoteTriggerHelper {</xmp></td><td style='background-color:#FFFFFF'>1</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp> public class QuoteTriggerHelper {</xmp></td></tr><tr><td style='background-color:#FFFFFF'>2</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>      static Map<String, Schema.RecordTypeInfo> QuoteRecoTypeDatas ;//= new Map<String, Schema.RecordTypeInfo>();</xmp></td><td style='background-color:#FFFFFF'>2</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>      static Map<String, Schema.RecordTypeInfo> QuoteRecoTypeDatas ;//= new Map<String, Schema.RecordTypeInfo>();</xmp></td></tr><tr><td style='background-color:#FFFFFF'>3</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>      static Map<Id, Opportunity> opptyMap ;</xmp></td><td style='background-color:#FFFFFF'>3</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>      static Map<Id, Opportunity> opptyMap ;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>4</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>     static Set<String> UpgradeSourceProductCodeSet = new Set<String>();</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>5</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>     static Map<Id,List<Asset>> AccountAssetMap ;</xmp></td></tr><tr><td style='background-color:#FFFFFF'>4</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp> </xmp></td><td style='background-color:#FFFFFF'>6</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp> </xmp></td></tr><tr><td style='background-color:#FFFFFF'>5</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     </xmp></td><td style='background-color:#FFFFFF'>7</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     </xmp></td></tr><tr><td style='background-color:#FFFFFF'>6</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     public static void populateFieldsOnInsert (List<SBQQ__Quote__c> qtList) {</xmp></td><td style='background-color:#FFFFFF'>8</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     public static void populateFieldsOnInsert (List<SBQQ__Quote__c> qtList) {</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>9</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>    </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>10</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>       system.debug('qtList===>'+ qtList);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>11</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>    </xmp></td></tr><tr><td style='background-color:#FFFFFF'>7</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         if(QuoteRecoTypeDatas == null){</xmp></td><td style='background-color:#FFFFFF'>12</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         if(QuoteRecoTypeDatas == null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'>8</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             QuoteRecoTypeDatas = qtList[0].getSobjectType().getDescribe().getRecordTypeInfosByDeveloperName();</xmp></td><td style='background-color:#FFFFFF'>13</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             QuoteRecoTypeDatas = qtList[0].getSobjectType().getDescribe().getRecordTypeInfosByDeveloperName();</xmp></td></tr><tr><td style='background-color:#FFFFFF'>9</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td><td style='background-color:#FFFFFF'>14</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>10</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td><td style='background-color:#FFFFFF'>15</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td></tr><tr><td style='background-color:#FFFFFF'>11</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         // Used the below query</xmp></td><td style='background-color:#FFFFFF'>16</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         // Used the below query</xmp></td></tr><tr><td style='background-color:#FFFFFF'>12</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         Set<Id> opptyIdSet = new Set<Id> ();</xmp></td><td style='background-color:#FFFFFF'>17</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         Set<Id> opptyIdSet = new Set<Id> ();</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>18</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        Set<Id> AccountIdSet = new Set<Id> ();</xmp></td></tr><tr><td style='background-color:#FFFFFF'>13</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         for(SBQQ__Quote__c qt : qtList) {</xmp></td><td style='background-color:#FFFFFF'>19</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         for(SBQQ__Quote__c qt : qtList) {</xmp></td></tr><tr><td style='background-color:#f1d0d2'>14</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            opptyIdSet.add(qt.SBQQ__Opportunity2__c);                </xmp></td><td style='background-color:#ccf1cc'>20</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            opptyIdSet.add(qt.SBQQ__Opportunity2__c); </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>21</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(qt.SBQQ__Account__c !=null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>22</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                AccountIdSet.add(qt.SBQQ__Account__c);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>23</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>24</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>25</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'>15</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td><td style='background-color:#FFFFFF'>26</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>16</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         if(opptyMap == null){</xmp></td><td style='background-color:#FFFFFF'>27</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         if(opptyMap == null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'>17</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>          opptyMap = getOpportunityFields(opptyIdSet);</xmp></td><td style='background-color:#FFFFFF'>28</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>          opptyMap = getOpportunityFields(opptyIdSet);</xmp></td></tr><tr><td style='background-color:#FFFFFF'>18</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td><td style='background-color:#FFFFFF'>29</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>30</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        // GO REFRESH CHANGES </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>31</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(UpgradeSourceProductCodeSet.isEmpty()){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>32</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                for(SBQQ__UpgradeSource__c UPGSRC : getUpgradeSources()){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>33</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        UpgradeSourceProductCodeSet.add(UPGSRC.SBQQ__SourceProduct__r.ProductCode);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>34</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>35</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>36</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(AccountAssetMap == null && UpgradeSourceProductCodeSet != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>37</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                AccountAssetMap = getAssets(AccountIdSet,UpgradeSourceProductCodeSet);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>38</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>39</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        // GO REFRESH CHANGES</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>40</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        </xmp></td></tr><tr><td style='background-color:#FFFFFF'>19</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         // </xmp></td><td style='background-color:#FFFFFF'>41</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         // </xmp></td></tr><tr><td style='background-color:#FFFFFF'>20</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         Opportunity QuotesOpportunityDetail ;</xmp></td><td style='background-color:#FFFFFF'>42</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         Opportunity QuotesOpportunityDetail ;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>43</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        List<Asset> AssetHolder;</xmp></td></tr><tr><td style='background-color:#FFFFFF'>21</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         for(SBQQ__Quote__c qt : qtList) {</xmp></td><td style='background-color:#FFFFFF'>44</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         for(SBQQ__Quote__c qt : qtList) {</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>45</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>46</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            // GO REFRESH CHANGES</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>47</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>48</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(qt.SBQQ__Opportunity2__c != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>49</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                system.debug('opptyMap = RenewedServiceContract'+opptyMap.get(qt.SBQQ__Opportunity2__c).SBQQSC__RenewedServiceContract__c);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>50</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>51</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>52</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(AccountAssetMap != null && qt.SBQQ__Account__c != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>53</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                AssetHolder = AccountAssetMap.get(qt.SBQQ__Account__c);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>54</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                if(AssetHolder != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>55</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    for(Asset Ast : AssetHolder){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>56</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        if(qt.Test_Asset__c == null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>57</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                            qt.Test_Asset__c = '';</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>58</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>59</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        if(qt.SBQQ__Type__c == 'Renewal' && Ast.Entitlements != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>60</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                            for(Entitlement Ent: Ast.Entitlements){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>61</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                                if(Ent.ServiceContractid == opptyMap.get(qt.SBQQ__Opportunity2__c).SBQQSC__RenewedServiceContract__c){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>62</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                                    qt.Test_Asset__c = qt.Test_Asset__c + Ast.id+',';</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>63</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                                    break;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>64</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>65</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>66</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>67</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        if(qt.SBQQ__Type__c == 'Quote'){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>68</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                            qt.Test_Asset__c = qt.Test_Asset__c + Ast.id+',';</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>69</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>70</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>71</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>72</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                if(qt.Test_Asset__c != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>73</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    qt.Test_Asset__c = qt.Test_Asset__c.removeEnd(',');</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>74</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>75</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>76</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>77</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            // GO REFRESH CHANGES</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>78</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            </xmp></td></tr><tr><td style='background-color:#FFFFFF'>22</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             //</xmp></td><td style='background-color:#FFFFFF'>79</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             //</xmp></td></tr><tr><td style='background-color:#FFFFFF'>23</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             if(opptyMap != null && qt.SBQQ__Opportunity2__c != null){</xmp></td><td style='background-color:#FFFFFF'>80</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             if(opptyMap != null && qt.SBQQ__Opportunity2__c != null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'>24</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 QuotesOpportunityDetail = opptyMap.get(qt.SBQQ__Opportunity2__c);</xmp></td><td style='background-color:#FFFFFF'>81</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 QuotesOpportunityDetail = opptyMap.get(qt.SBQQ__Opportunity2__c);</xmp></td></tr><tr><td colspan='6' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 20px;'>@@ -61,17 +118,18 @@ public class QuoteTriggerHelper {</td></tr><tr><td style='background-color:#FFFFFF'>61</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 }</xmp></td><td style='background-color:#FFFFFF'>118</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>62</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 qt.SBQQ__Status__c = 'Approved';</xmp></td><td style='background-color:#FFFFFF'>119</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 qt.SBQQ__Status__c = 'Approved';</xmp></td></tr><tr><td style='background-color:#FFFFFF'>63</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 /*</xmp></td><td style='background-color:#FFFFFF'>120</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 /*</xmp></td></tr><tr><td style='background-color:#f1d0d2'>64</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                WF Name : Set Watermark Shown               </xmp></td><td style='background-color:#ccf1cc'>121</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                WF Name : Remove Watermark Shown </xmp></td></tr><tr><td style='background-color:#f1d0d2'>65</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                description : ATG Created - Used to set the watermark on the quote if the quote is unapproved</xmp></td><td style='background-color:#ccf1cc'>122</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                description : ATG Created - Used to set the watermark on the quote if the quote is approved</xmp></td></tr><tr><td style='background-color:#FFFFFF'>66</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 */</xmp></td><td style='background-color:#FFFFFF'>123</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 */</xmp></td></tr><tr><td style='background-color:#f1d0d2'>67</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                qt.SBQQ__WatermarkShown__c = true;</xmp></td><td style='background-color:#ccf1cc'>124</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                qt.SBQQ__WatermarkShown__c = false;</xmp></td></tr><tr><td style='background-color:#FFFFFF'>68</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 </xmp></td><td style='background-color:#FFFFFF'>125</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 </xmp></td></tr><tr><td style='background-color:#FFFFFF'>69</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }else{</xmp></td><td style='background-color:#FFFFFF'>126</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }else{</xmp></td></tr><tr><td style='background-color:#FFFFFF'>70</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 /*</xmp></td><td style='background-color:#FFFFFF'>127</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 /*</xmp></td></tr><tr><td style='background-color:#f1d0d2'>71</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                WF Name : Remove Watermark Shown </xmp></td><td style='background-color:#ccf1cc'>128</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                WF Name : Set Watermark Shown               </xmp></td></tr><tr><td style='background-color:#f1d0d2'>72</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                description : ATG Created - Used to set the watermark on the quote if the quote is approved</xmp></td><td style='background-color:#ccf1cc'>129</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                description : ATG Created - Used to set the watermark on the quote if the quote is unapproved</xmp></td></tr><tr><td style='background-color:#FFFFFF'>73</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 */</xmp></td><td style='background-color:#FFFFFF'>130</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 */</xmp></td></tr><tr><td style='background-color:#f1d0d2'>74</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                qt.SBQQ__WatermarkShown__c = false;</xmp></td><td style='background-color:#ccf1cc'>131</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                qt.SBQQ__WatermarkShown__c = true;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>132</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                </xmp></td></tr><tr><td style='background-color:#FFFFFF'>75</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }</xmp></td><td style='background-color:#FFFFFF'>133</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>76</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             /*</xmp></td><td style='background-color:#FFFFFF'>134</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             /*</xmp></td></tr><tr><td style='background-color:#FFFFFF'>77</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             WF Name : Populate Default Quote Process and Address Info on new Quotes     </xmp></td><td style='background-color:#FFFFFF'>135</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             WF Name : Populate Default Quote Process and Address Info on new Quotes     </xmp></td></tr><tr><td colspan='6' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 20px;'>@@ -207,10 +265,7 @@ public class QuoteTriggerHelper {</td></tr><tr><td style='background-color:#FFFFFF'>207</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td><td style='background-color:#FFFFFF'>265</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>208</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         Opportunity QuotesOpportunityDetail ; </xmp></td><td style='background-color:#FFFFFF'>266</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         Opportunity QuotesOpportunityDetail ; </xmp></td></tr><tr><td style='background-color:#FFFFFF'>209</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td><td style='background-color:#FFFFFF'>267</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td></tr><tr><td style='background-color:#f1d0d2'>210</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>        //SF-6209</xmp></td><td style='background-color:#ccf1cc'>268</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        </xmp></td></tr><tr><td style='background-color:#f1d0d2'>211</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>        String oldQuoteDate= System.Label.Old_Quotes_Date;</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>212</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>        Date crtDate = Date.parse(oldQuoteDate);</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>213</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>        //SF-6209</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#FFFFFF'>214</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td><td style='background-color:#FFFFFF'>269</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td></tr><tr><td style='background-color:#FFFFFF'>215</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         for(SBQQ__Quote__c qt : qtList) {</xmp></td><td style='background-color:#FFFFFF'>270</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         for(SBQQ__Quote__c qt : qtList) {</xmp></td></tr><tr><td style='background-color:#FFFFFF'>216</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             if(opptyMap != null && qt.SBQQ__Opportunity2__c != null){</xmp></td><td style='background-color:#FFFFFF'>271</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             if(opptyMap != null && qt.SBQQ__Opportunity2__c != null){</xmp></td></tr><tr><td colspan='6' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 20px;'>@@ -238,16 +293,18 @@ public class QuoteTriggerHelper {</td></tr><tr><td style='background-color:#FFFFFF'>238</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     }</xmp></td><td style='background-color:#FFFFFF'>293</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>239</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     qt.SBQQ__Status__c = 'Approved';</xmp></td><td style='background-color:#FFFFFF'>294</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     qt.SBQQ__Status__c = 'Approved';</xmp></td></tr><tr><td style='background-color:#FFFFFF'>240</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     /*</xmp></td><td style='background-color:#FFFFFF'>295</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     /*</xmp></td></tr><tr><td style='background-color:#f1d0d2'>241</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                    WF Name : Set Watermark Shown               </xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>242</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                    description : ATG Created - Used to set the watermark on the quote if the quote is unapproved</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>243</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                    */</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>244</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                    qt.SBQQ__WatermarkShown__c = true;</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>245</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                }else{</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#f1d0d2'>246</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                    /*</xmp></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td></tr><tr><td style='background-color:#FFFFFF'>247</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     WF Name : Remove Watermark Shown </xmp></td><td style='background-color:#FFFFFF'>296</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     WF Name : Remove Watermark Shown </xmp></td></tr><tr><td style='background-color:#FFFFFF'>248</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     description : ATG Created - Used to set the watermark on the quote if the quote is approved</xmp></td><td style='background-color:#FFFFFF'>297</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     description : ATG Created - Used to set the watermark on the quote if the quote is approved</xmp></td></tr><tr><td style='background-color:#FFFFFF'>249</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     */</xmp></td><td style='background-color:#FFFFFF'>298</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     */</xmp></td></tr><tr><td style='background-color:#FFFFFF'>250</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     qt.SBQQ__WatermarkShown__c = false;</xmp></td><td style='background-color:#FFFFFF'>299</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                     qt.SBQQ__WatermarkShown__c = false;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>300</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>301</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }else{</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>302</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    /*</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>303</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    WF Name : Set Watermark Shown               </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>304</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    description : ATG Created - Used to set the watermark on the quote if the quote is unapproved</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>305</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    */</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>306</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    qt.SBQQ__WatermarkShown__c = true;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>307</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    </xmp></td></tr><tr><td style='background-color:#FFFFFF'>251</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 }</xmp></td><td style='background-color:#FFFFFF'>308</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                 }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>252</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }</xmp></td><td style='background-color:#FFFFFF'>309</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>253</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             </xmp></td><td style='background-color:#FFFFFF'>310</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             </xmp></td></tr><tr><td colspan='6' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 20px;'>@@ -317,18 +374,35 @@ public class QuoteTriggerHelper {</td></tr><tr><td style='background-color:#FFFFFF'>317</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             Ticket Number  :  SF-6209     </xmp></td><td style='background-color:#FFFFFF'>374</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             Ticket Number  :  SF-6209     </xmp></td></tr><tr><td style='background-color:#FFFFFF'>318</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             Description    :   When a Conditional PO is ordered (or when a POC with Type=Conditional PO is approved), then update the Approval Status field on all existing quotes to "Invalid and mark quote as non primary”        </xmp></td><td style='background-color:#FFFFFF'>375</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             Description    :   When a Conditional PO is ordered (or when a POC with Type=Conditional PO is approved), then update the Approval Status field on all existing quotes to "Invalid and mark quote as non primary”        </xmp></td></tr><tr><td style='background-color:#FFFFFF'>319</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             */</xmp></td><td style='background-color:#FFFFFF'>376</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             */</xmp></td></tr><tr><td style='background-color:#f1d0d2'>320</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            </xmp></td><td style='background-color:#ccf1cc'>377</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            String oldQuoteDate= System.Label.Old_Quotes_Date;</xmp></td></tr><tr><td style='background-color:#f1d0d2'>321</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            </xmp></td><td style='background-color:#ccf1cc'>378</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(qtOldMap != null && qtOldMap.get(qt.id).ApprovalStatus__c != qt.ApprovalStatus__c && qt.ApprovalStatus__c=='Invalid'){</xmp></td></tr><tr><td style='background-color:#f1d0d2'>322</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            if(qtOldMap.get(qt.id).ApprovalStatus__c != qt.ApprovalStatus__c && qt.ApprovalStatus__c=='Invalid' && qt.CreatedDate>crtDate){</xmp></td><td style='background-color:#ccf1cc'>379</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                Date crtDate;</xmp></td></tr><tr><td style='background-color:#f1d0d2'>323</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                qt.SBQQ__Status__c='Invalid';</xmp></td><td style='background-color:#ccf1cc'>380</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                if(oldQuoteDate != null){</xmp></td></tr><tr><td style='background-color:#f1d0d2'>324</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>                qt.SBQQ__Primary__c=false;    </xmp></td><td style='background-color:#ccf1cc'>381</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    String[] SplitDates = oldQuoteDate.split('/');</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>382</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    if(SplitDates != null && SplitDates.size() == 3){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>383</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                        crtDate = date.newInstance(integer.valueof(SplitDates[2]),integer.valueof(SplitDates[0]),integer.valueof(SplitDates[1]));</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>384</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>385</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>386</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                if(crtDate == null){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>387</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                     crtDate = date.newInstance(2019,03,01);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>388</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>389</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>390</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>391</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                if(crtDate != null && qt.CreatedDate>crtDate){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>392</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    qt.SBQQ__Status__c='Invalid';</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>393</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    qt.SBQQ__Primary__c=false;    </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>394</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>325</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }</xmp></td><td style='background-color:#FFFFFF'>395</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>             }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>326</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                </xmp></td><td style='background-color:#FFFFFF'>396</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>                </xmp></td></tr><tr><td style='background-color:#FFFFFF'>327</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td><td style='background-color:#FFFFFF'>397</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td></tr><tr><td style='background-color:#f1d0d2'>328</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp></xmp></td><td style='background-color:#ccf1cc'>398</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            /*</xmp></td></tr><tr><td style='background-color:#f1d0d2'>329</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            </xmp></td><td style='background-color:#ccf1cc'>399</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>             * Realted to SF 6645</xmp></td></tr><tr><td style='background-color:#f1d0d2'>330</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            </xmp></td><td style='background-color:#ccf1cc'>400</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>             * Added on 14th May 2020</xmp></td></tr><tr><td style='background-color:#f1d0d2'>331</td><td style='background-color:#fee8e9'>-</td><td style='background-color:#fee8e9'><xmp>            </xmp></td><td style='background-color:#ccf1cc'>401</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>             * Update the Record Type for Invalid Quote </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>402</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            */ </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>403</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            if(qt.SBQQ__Status__c == 'Invalid'){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>404</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>               qt.recordtypeid = QuoteRecoTypeDatas.get('Invalid_Quote').getRecordTypeId(); </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>405</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>332</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td><td style='background-color:#FFFFFF'>406</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         }</xmp></td></tr><tr><td style='background-color:#FFFFFF'>333</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td><td style='background-color:#FFFFFF'>407</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         </xmp></td></tr><tr><td style='background-color:#FFFFFF'>334</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>        </xmp></td><td style='background-color:#FFFFFF'>408</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>        </xmp></td></tr><tr><td colspan='6' style='background-color:#EFEFEF;padding-left: 10px;text-align: left;height: 20px;'>@@ -356,6 +430,25 @@ public class QuoteTriggerHelper {</td></tr><tr><td style='background-color:#FFFFFF'>356</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp> Opportunity_Sub_Type__c,Owner.Region__c,Owner.Sub_Region__c,Installation_Assigned_To__c,SBQQSC__AmendedServiceContract__c, SBQQSC__RenewedServiceContract__c,Account.OwnerId,(select id, POC_Type__c,POC_Duration__c,createdDate from Orders__r where POC_type__c='Conditional PO') FROM Opportunity WHERE Id = :opptyIdSet ] ); </xmp></td><td style='background-color:#FFFFFF'>430</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp> Opportunity_Sub_Type__c,Owner.Region__c,Owner.Sub_Region__c,Installation_Assigned_To__c,SBQQSC__AmendedServiceContract__c, SBQQSC__RenewedServiceContract__c,Account.OwnerId,(select id, POC_Type__c,POC_Duration__c,createdDate from Orders__r where POC_type__c='Conditional PO') FROM Opportunity WHERE Id = :opptyIdSet ] ); </xmp></td></tr><tr><td style='background-color:#FFFFFF'>357</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         return opptyMap;</xmp></td><td style='background-color:#FFFFFF'>431</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         return opptyMap;</xmp></td></tr><tr><td style='background-color:#FFFFFF'>358</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     }</xmp></td><td style='background-color:#FFFFFF'>432</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>433</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>    // GO REFRESH CHANGES </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>434</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>    </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>435</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        public static List<SBQQ__UpgradeSource__c> getUpgradeSources () {</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>436</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        return [SELECT Id,SBQQ__SourceProduct__c,SBQQ__SourceProduct__r.ProductCode from SBQQ__UpgradeSource__c];</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>437</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>438</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>439</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        public static Map<Id,List<Asset>> getAssets (Set<Id> ActIds,Set<String> UpgradeSourceProductCodeSet) {</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>440</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            Map<Id,List<Asset>> AccountAssetMap = new Map<Id,List<Asset>>();</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>441</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>        for(Asset Ast: [SELECT Id,ProductCode,Accountid,(select id,ServiceContractid from Entitlements) from Asset where UsageEndDate = null AND Accountid IN :ActIds AND ProductCode IN :UpgradeSourceProductCodeSet]){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>442</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                if(AccountAssetMap.containsKey(Ast.Accountid)){</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>443</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    AccountAssetMap.get(Ast.Accountid).add(Ast);</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>444</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }else{</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>445</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                    AccountAssetMap.put(Ast.Accountid,new List<Asset>{Ast});</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>446</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>447</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>                </xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>448</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>449</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>            return AccountAssetMap;</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>450</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>    }</xmp></td></tr><tr><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp></xmp></td><td style='background-color:#ccf1cc'>451</td><td style='background-color:#dfd'>+</td><td style='background-color:#dfd'><xmp>    // GO REFRESH CHANGES </xmp></td></tr><tr><td style='background-color:#FFFFFF'>359</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     </xmp></td><td style='background-color:#FFFFFF'>452</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     </xmp></td></tr><tr><td style='background-color:#FFFFFF'>360</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     public static void preventCloningQuote(){</xmp></td><td style='background-color:#FFFFFF'>453</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>     public static void preventCloningQuote(){</xmp></td></tr><tr><td style='background-color:#FFFFFF'>361</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>         ShGl_DisableFunctionalityLogic__c disableFuncCS = ShGl_DisableFunctionalityLogic__c.getInstance();</xmp></td><td style='background-color:#FFFFFF'>454</td><td style='background-color:#FFFFFF'></td><td style='background-color:#FFFFFF'><xmp>          ShGl_DisableFunctionalityLogic__c disableFuncCS = ShGl_DisableFunctionalityLogic__c.getInstance();</xmp></td></tr></tbody></table>